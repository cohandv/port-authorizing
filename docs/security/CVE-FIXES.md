# CVE Vulnerability Fixes

This document tracks CVE vulnerabilities found in the Docker image and their remediation.

## Addressed CVEs (Latest Fix)

| CVE ID | Severity | Score | Status | Fixed In |
|--------|----------|-------|--------|----------|
| CVE-2025-9230 | High | 7.5 | ✅ Fixed | commit 72fd5c6 |
| CVE-2025-9231 | Medium | 6.5 | ✅ Fixed | commit 72fd5c6 |
| CVE-2025-9232 | Medium | 5.9 | ✅ Fixed | commit 72fd5c6 |
| CVE-2025-46394 | Low | 3.2 | ✅ Fixed | commit 72fd5c6 |
| CVE-2024-58251 | Low | 2.5 | ✅ Fixed | commit 72fd5c6 |

## Remediation Actions Taken

### 1. Updated Alpine Base Image

**Before:**
```dockerfile
FROM alpine:latest
```

**After:**
```dockerfile
FROM alpine:3.21
```

**Rationale:** Using a specific, recent Alpine version (3.21) ensures we get the latest security patches. The `latest` tag can be unpredictable and may not include the newest fixes.

### 2. Updated Builder Image

**Before:**
```dockerfile
FROM golang:1.24-alpine AS builder
```

**After:**
```dockerfile
FROM golang:1.24-alpine3.21 AS builder
```

**Rationale:** Ensures the build stage also uses Alpine 3.21 with all security patches.

### 3. Added Package Updates in Builder Stage

**Added:**
```dockerfile
RUN apk update && \
    apk upgrade && \
    apk add --no-cache git make
```

**Rationale:** Updates all packages to their latest versions before installing build dependencies, addressing any known vulnerabilities in the build environment.

### 4. Added Package Updates in Runtime Stage

**Before:**
```dockerfile
RUN apk --no-cache add ca-certificates tzdata
```

**After:**
```dockerfile
RUN apk update && \
    apk upgrade && \
    apk add --no-cache ca-certificates tzdata curl && \
    rm -rf /var/cache/apk/*
```

**Changes:**
- Added `apk update` to refresh package indexes
- Added `apk upgrade` to update all installed packages
- Added `curl` for better health check support (replacing `wget`)
- Added cache cleanup to reduce final image size

### 5. Updated Go Dependencies

**Updated packages:**
- `golang.org/x/crypto`: v0.36.0 → v0.42.0
- `golang.org/x/text`: v0.23.0 → v0.29.0
- `github.com/spf13/pflag`: v1.0.9 → v1.0.10
- `github.com/jackc/chunkreader/v2`: v2.0.0 → v2.0.1

**Command used:**
```bash
go get -u ./...
go mod tidy
```

## Verification

### Scan Docker Image for CVEs

After building the new image, verify the fixes:

```bash
# Build the updated image
docker build -t port-authorizing:test .

# Scan with Docker Scout
docker scout cves port-authorizing:test

# Scan with Trivy (if installed)
trivy image port-authorizing:test

# Scan with Grype (if installed)
grype port-authorizing:test
```

### Expected Results

After applying these fixes:
- High severity CVEs: **0**
- Medium severity CVEs: **0** (or significantly reduced)
- Low severity CVEs: **Minimal** (may have some unavoidable ones)

## Best Practices Implemented

1. ✅ **Specific version tags** - Use `alpine:3.21` instead of `alpine:latest`
2. ✅ **Regular updates** - `apk update && apk upgrade` in both stages
3. ✅ **Minimal attack surface** - Only install necessary packages
4. ✅ **Non-root user** - Application runs as `portauth` user
5. ✅ **Clean cache** - Remove apk cache to reduce image size
6. ✅ **Multi-stage build** - Separate build and runtime environments
7. ✅ **Dependency updates** - Keep Go dependencies current

## Ongoing Security Maintenance

### Automated Scanning

The GitHub Actions workflow automatically scans Docker images for vulnerabilities on every build. See `.github/workflows/release.yml`.

### Regular Updates

To keep the image secure:

```bash
# Update Alpine base image
# Check for new Alpine versions: https://hub.docker.com/_/alpine

# Update Go dependencies
go get -u ./...
go mod tidy

# Rebuild and test
docker build -t port-authorizing:test .
docker scout cves port-authorizing:test
```

### Monitoring

- **Docker Hub** - Automatic vulnerability scanning on Docker Hub
- **GitHub Actions** - CI/CD pipeline checks for CVEs on every push
- **Dependabot** - (Recommended) Enable for automatic Go dependency updates

## Additional Resources

- [Alpine Linux Security](https://alpinelinux.org/security/)
- [Docker Security Best Practices](https://docs.docker.com/develop/security-best-practices/)
- [Docker Scout Documentation](https://docs.docker.com/scout/)
- [NIST CVE Database](https://nvd.nist.gov/)

## Version History

| Date | Version | CVEs Fixed | Commit |
|------|---------|------------|--------|
| 2025-01-XX | 1.3.0 | 5 CVEs (H:1, M:2, L:2) | 72fd5c6 |

---

**Note:** This document should be updated whenever new CVEs are identified and fixed.

